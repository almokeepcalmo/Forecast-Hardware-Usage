# Forecast Hardware Usage
### Приложение, используемое для прогнозирования утилизации ресурсов сервера
Для мониторинга применяется связка Prometheus + Grafana + Prophet.
### Алгоритм работы:
* В дашборде Grafana выбирается хост, по которому нужно сделать прогноз, и число дней, на которые нужно сделать этот самый прогноз
* По нажатию кнопки "Сделать прогноз", Grafana делает POST-запрос на вэб-сервер, передавая IP-адрес хоста и число дней
* Сервер принимает переменные и запускает скрипт, отвечающий за сбор данных и прогноз
* Скрипт производит запросы к Prometheus, в которые динамически подставляются в качестве переменных IP-адрес и кол-во дней, за которые нужно получить данные
* Полученные данные формируются в DataFrame, на основе которого Prophet делает прогноз на число дней, указанное в дашборде
* Результат прогноза пишется в CSV-файл по следующему пути: /csv/forecasted_<cpu/ram/disk>_data.csv
* На графиках дашборда используется DataSource "Infinity", который выполняет GET-запросы к вэб-серверу по соответствующим путям
* Сервер в ответ на GET-запросы посылает нужный CSV-файл, на основе которого строится график на будущее

### Из чего состоит прогнозчик:
* app/endpoint.py - поднимает сервер с FastAPI, принимающий запросы от Grafana и отдающий CSV-файлы с прогнозируемыми результатами
* app/forecast_node.py - скрипт, срабатывающий при POST-запросе на сервер. Выполняет прогнозы CPU & RAM & DISK с метрик node_exporter и пишет их в /csv/

Прогнозирование данных выполняется с помощью библиотеки [Prophet](https://facebook.github.io/prophet/).

Образ с приложением собирается на основе образа [python:3.10-slim](https://hub.docker.com/layers/library/python/3.10-slim/).

Вывод CSV-файлов с прогнозируемыми данными реализован с плагином для Grafana [Infinity](https://grafana.com/grafana/plugins/yesoreyeram-infinity-datasource/).

Для запуска прогнозчика НЕ в контейнере необходима директория "/csv", либо же можно изменить путь в скриптах на любой удобный, запустить командой uvicorn endpoint:app --host 0.0.0.0 --port 8000 --reload
